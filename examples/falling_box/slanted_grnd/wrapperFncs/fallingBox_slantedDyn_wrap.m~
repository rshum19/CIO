function [dz, Phi, Psi] = fallingBox_slantedDyn_wrap(t,z,lambda,params)


%% ----------------------------------------------------------
%   READ AND INTERPRET INPUTS
% -----------------------------------------------------------
nt = length(t);
p = params;
x = z(1:2,:);
dx = z(3:4,:);
g = p.g;
h = p.h;

% Gravity vector
G = [0;-g];

if isempty(lambda)
    lambda = zeros(1,nt);
end
nc = size(lambda,1);
%% ----------------------------------------------------------
%   EQUATION OF MOTION
% -----------------------------------------------------------
% Allocate memory
Phi = zeros(nc,nt);

for i = 1:nt
 
    % Contact dynamic matrices Phi, Psi, J
    [Phi(:,i),Psi(:,i),J(:,:,i)] = fallingBox_contactDyn_wrapper(x,p);

    % Box acceleration
    ddx(:,i)  = G + J(:,:,i)'*lambda(:,i)./p.m;
    
    % Phi function -- contact point equation
    %Phi(:,i) = x(2,i) - h/2;
 
    % Velocity of contact point
    %Psi(:,i) = J*dx(:,i); % Psi_y
    %Psi(:,i) = 0; % Psi_x
end

dz = [dx;ddx];
end

